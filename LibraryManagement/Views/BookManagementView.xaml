<UserControl x:Class="LibraryManagement.Views.BookManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:LibraryManagement.Views"
             xmlns:converters="clr-namespace:LibraryManagement.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000"
             x:Name="bookManagementView">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="âž• ThÃªm sÃ¡ch" Command="{Binding AddBookCommand}" 
                    Padding="15,8" Margin="0,0,5,0" FontSize="14" Background="#4CAF50" Foreground="White" BorderThickness="0" Cursor="Hand"/>
            <Button Content="ðŸ“– MÆ°á»£n sÃ¡ch" Command="{Binding BorrowBookCommand}" 
                    Padding="15,8" Margin="5,0" FontSize="14" Background="#FF9800" Foreground="White" BorderThickness="0" Cursor="Hand"/>
            <Button Content="ðŸ“· QuÃ©t QR" Command="{Binding ScanQRCommand}" 
                    Padding="15,8" Margin="5,0" FontSize="14" Background="#9C27B0" Foreground="White" BorderThickness="0" Cursor="Hand"/>
            <Button Content="ðŸ”„ LÃ m má»›i" Command="{Binding RefreshCommand}" 
                    Padding="15,8" Margin="5,0,0,0" FontSize="14" Background="#607D8B" Foreground="White" BorderThickness="0" Cursor="Hand"/>
        </StackPanel>

        <!-- Search Box -->
        <Border Grid.Row="1" BorderBrush="#DDD" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,0,0,10" Background="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="ðŸ” TÃ¬m kiáº¿m:" VerticalAlignment="Center" FontSize="14" Margin="0,0,10,0"/>
                <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                         FontSize="14" Padding="5" BorderThickness="1" BorderBrush="#CCC"/>
            </Grid>
        </Border>

        <!-- Books DataGrid -->
        <Border Grid.Row="2" BorderBrush="#DDD" BorderThickness="1" CornerRadius="5" Background="White">
            <DataGrid x:Name="booksDataGrid"
                      ItemsSource="{Binding FilteredBooks}" 
                      SelectionMode="Single"
                      SelectionUnit="CellOrRowHeader"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      RowHeight="35"
                      AlternationCount="999999"
                      AlternatingRowBackground="#F5F5F5"
                SelectionChanged="booksDataGrid_SelectionChanged">
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#2196F3"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="BorderBrush" Value="#1976D2"/>
                        <Setter Property="BorderThickness" Value="0,0,1,0"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.Columns>
                <DataGridCheckBoxColumn Header="Chá»n" Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Width="60">
                        <DataGridCheckBoxColumn.ElementStyle>
                            <Style TargetType="CheckBox">
                                <Setter Property="HorizontalAlignment" Value="Center"/>

                                <Setter
                                    Property="VerticalAlignment"
                                    Value="Center" />
                            </Style>
                        </DataGridCheckBoxColumn.ElementStyle>
                    </DataGridCheckBoxColumn>
                    <DataGridTextColumn Header="STT" IsReadOnly="True" Width="50">
                        <DataGridTextColumn.Binding>
                            <Binding Path="(ItemsControl.AlternationIndex)" RelativeSource="{RelativeSource AncestorType=DataGridRow}">
                                <Binding.Converter>
                                    <converters:IndexConverter/>
                                </Binding.Converter>
                            </Binding>
                        </DataGridTextColumn.Binding>
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTemplateColumn Width="*" MinWidth="200">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="TiÃªu Ä‘á»" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterTitle, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="530" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Title}" VerticalAlignment="Center" Padding="5,0"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn
                        Width="250">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock
                                    Text="TÃ¡c giáº£"
                                    FontWeight="Bold"
                                    HorizontalAlignment="Center"
                                    Margin="0,0,0,5" />
                                <TextBox
                                    Text="{Binding DataContext.FilterAuthor, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                    Width="250"
                                    FontSize="11"
                                    Padding="3"
                                    Background="White"
                                    BorderBrush="#90CAF9" />
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock
                                    Text="{Binding Author}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="150">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="NhÃ  xuáº¥t báº£n" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterPublisher, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="130" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Publisher}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="100">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="NÄƒm XB" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterYear, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="100" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding PublishYear}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="120">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="Thá»ƒ loáº¡i" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterCategory, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="100" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Category}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="100">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="Sá»‘ lÆ°á»£ng" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterQuantity, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="100" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Quantity}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="80">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="CÃ²n láº¡i" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterAvailable, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="60" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding AvailableQuantity}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Thao tÃ¡c" Width="110">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="âœï¸" ToolTip="Sá»­a"
                                            Command="{Binding DataContext.EditBookRowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Width="30" Height="25" Margin="2" 
                                            Background="#2196F3" Foreground="White" 
                                            BorderThickness="0" Cursor="Hand" FontSize="12"/>
                                    <Button Content="ðŸ—‘ï¸" ToolTip="XÃ³a"
                                            Command="{Binding DataContext.DeleteBookRowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Width="30" Height="25" Margin="2" 
                                            Background="#F44336" Foreground="White" 
                                            BorderThickness="0" Cursor="Hand" FontSize="12"/>
                                    <Button Content="ðŸ“–" ToolTip="MÆ°á»£n sÃ¡ch"
                                            Command="{Binding DataContext.BorrowBookRowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Width="30" Height="25" Margin="2" 
                                            Background="#FF9800" Foreground="White" 
                                            BorderThickness="0" Cursor="Hand" FontSize="12"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>
