<UserControl x:Class="LibraryManagement.Views.BorrowManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:LibraryManagement.Views"
             xmlns:converters="clr-namespace:LibraryManagement.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="ðŸ”„ LÃ m má»›i" Command="{Binding RefreshCommand}" 
                    Padding="15,8" Margin="5,0,0,0" FontSize="14" Background="#607D8B" Foreground="White" BorderThickness="0" Cursor="Hand"/>
        </StackPanel>

        <!-- Search and Filter -->
        <Border Grid.Row="1" BorderBrush="#DDD" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,0,0,10" Background="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="ðŸ” TÃ¬m kiáº¿m:" VerticalAlignment="Center" FontSize="14" Margin="0,0,10,0"/>
                <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                         FontSize="14" Padding="5" BorderThickness="1" BorderBrush="#CCC"/>
                
                <TextBlock Grid.Column="3" Text="Tráº¡ng thÃ¡i:" VerticalAlignment="Center" FontSize="14" Margin="0,0,10,0"/>
                <ComboBox Grid.Column="4" ItemsSource="{Binding StatusFilters}" 
                          SelectedItem="{Binding FilterStatus}"
                          FontSize="14" Padding="5" BorderThickness="1" BorderBrush="#CCC"/>
            </Grid>
        </Border>

        <!-- Borrow Records DataGrid -->
        <Border Grid.Row="2" BorderBrush="#DDD" BorderThickness="1" CornerRadius="5" Background="White">
            <DataGrid ItemsSource="{Binding FilteredRecords}" 
                      SelectedItem="{Binding SelectedRecord}"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      SelectionMode="Extended"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      RowHeight="35"
                      AlternationCount="999999"
                      AlternatingRowBackground="#F5F5F5">
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#2196F3"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="BorderBrush" Value="#1976D2"/>
                        <Setter Property="BorderThickness" Value="0,0,1,0"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="STT" IsReadOnly="True" Width="50">
                        <DataGridTextColumn.Binding>
                            <Binding Path="(ItemsControl.AlternationIndex)" RelativeSource="{RelativeSource AncestorType=DataGridRow}">
                                <Binding.Converter>
                                    <converters:IndexConverter/>
                                </Binding.Converter>
                            </Binding>
                        </DataGridTextColumn.Binding>
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn
                        MaxWidth="200">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="NgÆ°á»i mÆ°á»£n" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterName, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="200" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding BorrowerName}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn
                        MaxWidth="150">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="Cáº¥p báº­c" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterRank, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="150" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Rank}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn
                        MaxWidth="150">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="Chá»©c vá»¥" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterPosition, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="150" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Position}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn
                        MaxWidth="150">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="ÄÆ¡n vá»‹" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterUnit, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="150" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Unit}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn MaxWidth="150">
                        <DataGridTemplateColumn.Header>
                            <StackPanel>
                                <TextBlock Text="Sá»‘ Ä‘iá»‡n thoáº¡i" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding DataContext.FilterPhone, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                         Width="150" FontSize="11" Padding="3" Background="White" BorderBrush="#90CAF9"/>
                            </StackPanel>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding BorrowerPhone}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="NgÃ y mÆ°á»£n" Binding="{Binding BorrowDate, StringFormat='dd/MM/yyyy'}" Width="115">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        Header="Háº¡n tráº£"
                        Binding="{Binding DueDate, StringFormat='dd/MM/yyyy'}"
                        Width="115">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="NgÃ y tráº£" Binding="{Binding ReturnDate, StringFormat='dd/MM/yyyy'}" Width="95">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Tráº¡ng thÃ¡i" Binding="{Binding Status}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="Äang mÆ°á»£n">
                                        <Setter Property="Foreground" Value="#2196F3"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Trigger>
                                    <Trigger Property="Text" Value="ÄÃ£ tráº£">
                                        <Setter Property="Foreground" Value="#4CAF50"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Trigger>
                                    <Trigger Property="Text" Value="QuÃ¡ háº¡n">
                                        <Setter Property="Foreground" Value="#F44336"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="Thao tÃ¡c" MinWidth="100" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="ðŸ‘ï¸" ToolTip="Xem chi tiáº¿t"
                                            Command="{Binding DataContext.ViewDetailRowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Width="30" Height="25" Margin="2" 
                                            Background="#2196F3" Foreground="White" 
                                            BorderThickness="0" Cursor="Hand" FontSize="12"/>
                                    <Button Content="âœ”ï¸" ToolTip="Tráº£ sÃ¡ch"
                                            Command="{Binding DataContext.ReturnBookRowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Width="30" Height="25" Margin="2" 
                                            Background="#4CAF50" Foreground="White" 
                                            BorderThickness="0" Cursor="Hand" FontSize="12"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>
