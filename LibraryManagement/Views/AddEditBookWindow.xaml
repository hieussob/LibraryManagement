<Window x:Class="LibraryManagement.Views.AddEditBookWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LibraryManagement.Views"
        xmlns:converters="clr-namespace:LibraryManagement.Converters"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" Height="550" Width="1050"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">
    
    <Window.Resources>
        <converters:Base64ToImageConverter x:Key="Base64ToImageConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:StringToBoolConverter x:Key="StringToBoolConverter"/>
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="15"/>
            <ColumnDefinition Width="220"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" Grid.Column="0" VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Row 0: TiÃªu Ä‘á» sÃ¡ch vÃ  TÃ¡c giáº£ -->
                <StackPanel Grid.Row="0" Grid.Column="0">
                    <TextBlock Text="TiÃªu Ä‘á» sÃ¡ch *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.Title, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="8" FontSize="14" Margin="0,0,0,15" BorderBrush="#CCC" BorderThickness="1"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="2">
                    <TextBlock Text="TÃ¡c giáº£ *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.Author, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="8" FontSize="14" Margin="0,0,0,15" BorderBrush="#CCC" BorderThickness="1"/>
                </StackPanel>

                <!-- Row 1: MÃ£ QR vÃ  NhÃ  xuáº¥t báº£n -->
                <StackPanel Grid.Row="1" Grid.Column="0">
                    <TextBlock Text="MÃ£ QR Code" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <Grid Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            Text="(Tá»± Ä‘á»™ng táº¡o)"
                            Padding="8"
                            FontSize="14"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Foreground="Gray" />
                    </Grid>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="2">
                    <TextBlock Text="NhÃ  xuáº¥t báº£n" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.Publisher, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="8" FontSize="14" Margin="0,0,0,15" BorderBrush="#CCC" BorderThickness="1"/>
                </StackPanel>

                <!-- Row 2: NÄƒm xuáº¥t báº£n vÃ  Thá»ƒ loáº¡i -->
                <StackPanel Grid.Row="2" Grid.Column="0">
                    <TextBlock Text="NÄƒm xuáº¥t báº£n" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.PublishYear, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="8" FontSize="14" Margin="0,0,0,15" BorderBrush="#CCC" BorderThickness="1"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Grid.Column="2">
                    <TextBlock Text="Thá»ƒ loáº¡i" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.Category, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="8" FontSize="14" Margin="0,0,0,15" BorderBrush="#CCC" BorderThickness="1"/>
                </StackPanel>

                <!-- Row 3: Sá»‘ lÆ°á»£ng vÃ  CÃ²n láº¡i -->
                <StackPanel Grid.Row="3" Grid.Column="0">
                    <TextBlock Text="Sá»‘ lÆ°á»£ng *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.Quantity, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="8" FontSize="14" Margin="0,0,0,15" BorderBrush="#CCC" BorderThickness="1"/>
                </StackPanel>

                <StackPanel Grid.Row="3" Grid.Column="2">
                    <TextBlock Text="CÃ²n láº¡i" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.AvailableQuantity, UpdateSourceTrigger=PropertyChanged}" 
                             Padding="8" FontSize="14" Margin="0,0,0,15" BorderBrush="#CCC" BorderThickness="1"/>
                </StackPanel>

                <!-- Row 4: MÃ´ táº£ (Full width) -->
                <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3">
                    <TextBlock Text="MÃ´ táº£" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Book.Description, UpdateSourceTrigger=PropertyChanged}" 
                             TextWrapping="Wrap" AcceptsReturn="True"
                             Height="100" Padding="8" FontSize="14" Margin="0,0,0,15" 
                             BorderBrush="#CCC" BorderThickness="1" VerticalScrollBarVisibility="Auto"/>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- QR Code Display -->
        <Border Grid.Row="0" Grid.Column="2" BorderBrush="#DDD" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,20,0,15" Background="White">
            <StackPanel>
                <TextBlock Text="MÃ£ QR" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                
                <!-- QR Image -->
                <Border BorderBrush="#EEE" BorderThickness="1" CornerRadius="3" Padding="5" Margin="0,0,0,10"
                        Visibility="{Binding Book.QrCode, Converter={StaticResource StringToBoolConverter}, ConverterParameter=true}">
                    <Image Source="{Binding Book.QrCode, Converter={StaticResource Base64ToImageConverter}}" 
                           Width="190" Height="190" Stretch="Uniform"/>
                </Border>
                
                <!-- Placeholder when no QR -->
                <Border BorderBrush="#EEE" BorderThickness="1" CornerRadius="3" Padding="5" Height="200"
                        Background="#F9F9F9">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Book.QrCode, Converter={StaticResource StringToBoolConverter}}" Value="False">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <TextBlock Text="ChÆ°a cÃ³ mÃ£ QR&#x0a;Nháº¥n 'Táº¡o QR' Ä‘á»ƒ táº¡o" 
                               HorizontalAlignment="Center" 
                               VerticalAlignment="Center"
                               TextAlignment="Center"
                               Foreground="#999"
                               FontSize="12"/>
                </Border>
            </StackPanel>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right" >
            <Button
                Grid.Column="1"
                Content="Xuáº¥t QR"
                Command="{Binding ExportQRCommand}"
                Padding="15,8"
                Background="#4CAF50"
                Foreground="White"
                BorderThickness="0"
                Cursor="Hand" />
            <Button Content="ðŸ’¾ LÆ°u" Command="{Binding SaveCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                    Padding="20,10" Margin="10,0,10,0" FontSize="14" Background="#4CAF50" Foreground="White" BorderThickness="0" Cursor="Hand"/>
            <Button
                Content="âŒ Há»§y"
                IsCancel="True"
                Padding="20,10"
                FontSize="14"
                Background="#9E9E9E"
                Foreground="White"
                BorderThickness="0"
                Cursor="Hand" />
        </StackPanel>
    </Grid>
</Window>
